---
title: 'Go ã® Cloud Functions ã§ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚Šã‚’ã™ã‚‹ã®ã«ã²ã¨å·¥å¤«å¿…è¦ã ã£ãŸ'
emoji: 'ğŸ”–'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['Go', 'GCP']
published: true
---

# æ¦‚è¦

<!-- textlint-disable ja-technical-writing/ja-no-weak-phrase -->

- Go ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã® Cloud Functions ã§ã¯ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ `serverless_function_source_code` é…ä¸‹ã«ã‚ã‚‹
- buildpacks ã‚’ä½¿ãˆã°åŒã˜æŒ™å‹•ã‚’å†ç¾ã§ãã‚‹
- buildpacks ã‚’ä½¿ã‚ãšã¨ã‚‚ Cloud Functionãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¨ã‚‚ã«å‹•ãã‚³ãƒ¼ãƒ‰ã¯æ›¸ã‘ã‚‹ã®ã§ã€ç„¡ç†ã—ã¦ä½¿ã†å¿…è¦ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚

<!-- textlint-enable -->

# çµŒç·¯

Go ã§å‹•ã Cloud Functions ã®å‡¦ç†ã®ä¸­ã§ã€GCS ã«ç½®ãã»ã©ã§ã‚‚ãªã„ã‚ˆã†ãªã€èª­ã¿å–ã‚Šå°‚ç”¨ã® JSON ãƒ‡ãƒ¼ã‚¿ã‚’ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ä¸€ç·’ã«ç®¡ç†ã—ã¦ã„ã¾ã—ãŸã€‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ä¸‹è¨˜ã®ã‚ˆã†ãªæ„Ÿã˜ã§ã™ã€‚

```sh
$ tree
â”œâ”€â”€ hoge-function
â”‚   â”œâ”€â”€ cmd
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ function.go   # function ã®æœ¬ä½“
â”‚   â”œâ”€â”€ go.mod
â”‚   â”œâ”€â”€ go.sum
â”‚   â””â”€â”€ static
â”‚       â””â”€â”€ hoge.json # èª­ã¿å–ã‚ŠãŸã„é™çš„ãª JSON ãƒ•ã‚¡ã‚¤ãƒ«
```

ã‚³ãƒ³ãƒ†ãƒŠåŒ–ãªã©ã¯ã›ãšã« [functions-framework-go](https://github.com/GoogleCloudPlatform/functions-framework-go) ã‚’ä½¿ã£ã¦ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚’å‹•ã‹ã—ã¦ã„ã¾ã™ã€‚`cmd/main.go` ãŒãƒ­ãƒ¼ã‚«ãƒ«ã§ã®é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã«ãªã‚Šã¾ã™ã€‚é–¢æ•°ã®å‡¦ç†ã¯ `function.go` ã«ã‚ã‚Šã¾ã™ã€‚

```go:function.go
func ReadFile(w http.ResponseWriter, r *http.Request) {
  b, err := os.ReadFile("static/hoge.json")
  if err != nil {
    log.Println(err)
  }
  log.Println("static json content", string(b))
}
```

ã“ã®å‡¦ç†ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ã¨ã€å½“ç„¶ãªãŒã‚‰ `static/hoge.json` ã®ä¸­èº«ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

ã—ã‹ã—ã€ã“ã‚Œã‚’ Cloud Functions ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å‹•ã‹ã™ã¨ã€ä¸‹è¨˜ã®ã‚ˆã†ãªçµæœã«ãªã‚Šã¾ã™ã€‚

![cloud-logging-error](https://storage.googleapis.com/zenn-user-upload/fb4444b00cd3-20220808.png)

`os.ReadFile` ã‚’å®Ÿè¡Œã§ã‚¨ãƒ©ãƒ¼ãŒè¿”å´ã•ã‚Œã¦ã„ã¾ã™...ï¼ãã‚“ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯ãªã„ã¨è¨€ã‚ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚

# åŸå› 

åŸå› ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ãŒã‚ã‚Šã¾ã—ãŸã€‚

https://cloud.google.com/functions/docs/concepts/execution-environment#memory-file-system

> æ³¨: Cloud Functions å®Ÿè¡Œç’°å¢ƒã§ã¯ã€é–¢æ•°ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ«ãƒ¼ãƒˆ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ.ï¼‰ã«ãªã‚Šã¾ã™ã€‚ãŸã ã—ã€Go ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®å ´åˆã¯ã€é–¢æ•°ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãƒ«ãƒ¼ãƒˆ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒ ./serverless_function_source_code ã«ã‚ã‚‹ç¾åœ¨ã®ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸‹ã«ãªã‚Šã¾ã™ã€‚

ğŸ˜…

åˆè€³ã§ã—ãŸã€‚Go ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã® Cloud Functions ã®å®Ÿè¡Œç’°å¢ƒã§ã¯ã€`serverless_function_source_code` é…ä¸‹ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒç½®ã‹ã‚Œã‚‹ä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
è©¦ã—ã« Cloud Functions ä¸Šã§ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã€ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å‡ºåŠ›ã—ã¦ã¿ã¾ã—ãŸã€‚

```go:function.go
func ReadFile(w http.ResponseWriter, r *http.Request) {
  err := filepath.Walk("./", func(path string, _ os.FileInfo, err error) error {
    if err != nil {
      return err
    }

    fmt.Printf("path: %#v\n", path)
    return nil
  })
  if err != nil {
    log.Println(err)
  }
}
```

å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ `/workspace` ã®ã‚ˆã†ã§ã™ã€‚ãã®é…ä¸‹ã«ç¢ºã‹ã« `serverless_function_source_code` ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ã¦ãŠã‚Šã€ãã®é…ä¸‹ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

![filepath.Walk()ã®çµæœ](https://storage.googleapis.com/zenn-user-upload/da46ef525960-20220809.png)

è¦‹ã‚„ã™ãã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```
/
â”œâ”€â”€ workspace
â”‚   â”œâ”€â”€ .googlebuild
â”‚   â”‚   â””â”€â”€ source-code.tar.gz
â”‚   â”œâ”€â”€ go.mod
â”‚   â”œâ”€â”€ go.sum
â”‚   â”œâ”€â”€ main.go
â”‚   â””â”€â”€ serverless_function_source_code
â”‚       â”œâ”€â”€ cmd
â”‚       â”‚   â””â”€â”€ main.go
â”‚       â”œâ”€â”€ function.go
â”‚       â”œâ”€â”€ go.mod
â”‚       â”œâ”€â”€ go.sum
â”‚       â””â”€â”€ static
â”‚           â””â”€â”€ hoge.json
```

# å¯¾ç­–

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã‚‚ Cloud Function ã®å®Ÿè¡Œç’°å¢ƒã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿å–ã‚Šã‚’è¡Œã†ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã„ã„ã‹è€ƒãˆã¦ã¿ã¾ã—ãŸã€‚

å‰æã¨ã—ã¦ã€Cloud Functions ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ã«ã¯ 2 é€šã‚Šã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚1 ã¤ã¯ã€ŒFunction Frameworks ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã€ã‚‚ã† 1 ã¤ã¯ã€ŒCloud Native Buildpacks ã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã€ã§ã™ã€‚

https://cloud.google.com/functions/docs/running/overview?hl=ja#choosing_an_abstraction_layer

ãã‚Œãã‚Œã®æ–¹æ³•ã‚’ä½¿ã£ãŸå ´åˆã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### 1. Function Frameworks ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

Function Frameworks ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¨ Cloud Functions ã®å®Ÿè¡Œç’°å¢ƒãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãŒç•°ãªã‚‹ã®ã§ã€ãã®å·®åˆ†ã‚’å—ã‘å…¥ã‚Œã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚
èª­ã¿å–ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æƒ…å ±ã‚’ç’°å¢ƒå¤‰æ•°åŒ–ã—ã€ãã®å€¤ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ã„ãšã‚Œã®ç’°å¢ƒã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å–ã‚ŠãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```go:function.go
// SOURCE_DIR
// ãƒ­ãƒ¼ã‚«ãƒ«: ""
// CFç’°å¢ƒ: "serverless_function_source_code/"
b, err = os.ReadFile(os.Getenv("SOURCE_DIR") + "static/hoge.json")
if err != nil {
  log.Println(err)
}

log.Println("static json content", string(b))
```

ç’°å¢ƒã®é•ã„ã‚’æ„è­˜ã—ãŸã‚³ãƒ¼ãƒ‰ãŒç”Ÿã¾ã‚Œã¦ã—ã¾ã†ç‚¹ãŒãƒ‡ãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚ã€Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ `/workspace/serverless_function_source_code` ã«ã‚ã‚‹ã€ã¨ã„ã†ä»•æ§˜ã‚’çŸ¥ã‚‰ãªã„ã¨ã€ãªãœã“ã®å‡¦ç†ãŒå¿…è¦ãªã®ã‹ã‚ã‹ã‚Šã¥ã‚Šã‚‰ã„ã§ã™ã€‚ãƒ¡ãƒªãƒƒãƒˆã¯ Function Frameworks ã®å°å…¥ãŒæ‰‹è»½ãªã“ã¨ãƒ»ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„ã“ã¨ã§ã™ã€‚å¾Œè¿°ã™ã‚‹ Buildpacks ã§ã¯ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã®éƒ½åº¦ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ & ç«‹ã¡ä¸Šã’ãŒå¿…è¦ã§ã€é–‹ç™ºä½“é¨“ã¯ã‚¤ãƒã‚¤ãƒãªã®ã§ã™ãŒã€ã“ã¡ã‚‰ã¯ `go run` ã™ã‚Œã°ã‚ˆã„ã ã‘ãªã®ã§æ‰‹è»½ã§ã™ã€‚

### 2. Cloud Native Buildpacks ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

<!-- textlint-disable ja-technical-writing/sentence-length -->

[Cloud Native Buildpacks](https://github.com/googlecloudplatform/buildpacks) ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã¨ Cloud Functions ã®å®Ÿè¡Œç’°å¢ƒã‚’ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã§ãã¾ã™ã€‚ãã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œã™ã‚Œã° Cloud Functions ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ã¨ã»ã¼åŒã˜ç’°å¢ƒã‚’ä½œã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å½“ç„¶ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã‚‚åŒã˜ã§ `/workspace/serverless_function_source_code` ã«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒç½®ã‹ã‚Œã‚‹ã®ã§ã€ä½•ã‚‚è€ƒãˆãšã« `serverless_function_source_code` é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

<!-- textlint-enable -->

```go:function.go
b, err = os.ReadFile("serverless_function_source_code/static/hoge.json")
if err != nil {
  log.Println(err)
}

log.Println("static json content", string(b))
```

<!-- textlint-disable ja-technical-writing/sentence-length -->

å®Ÿè¡Œç’°å¢ƒã®å·®åˆ†ã‚’æ„è­˜ã›ãšã«é–‹ç™ºãŒã§ãã‚‹ã“ã¨ã¯ãƒ¡ãƒªãƒƒãƒˆã§ã™ãŒã€å‰è¿°ã®é€šã‚Šã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ãŸã³ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ã—ç›´ã•ã­ã°ãªã‚‰ãªãšã€ãƒ‡ãƒãƒƒã‚°ã«æ™‚é–“ãŒã‹ã‹ã‚‹ç‚¹ã¯ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã§ã™ã€‚ã¾ãŸã€ã“ã®å ´åˆã§ã‚‚ã€Œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒ `/workspace/serverless_function_source_code` ã«ã‚ã‚‹ã€ã¨ã„ã†ä»•æ§˜ã‚’çŸ¥ã‚‰ãªã„ã¨è¬ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‚ç…§ã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¦ã—ã¾ã„ã¾ã™ã€‚

<!-- textlint-enable -->

### æœ€çµ‚çš„ã«ç­†è€…ã¯ã©ã†ã—ãŸã‹

1 ã® Function Frameworks ã‚’ä½¿ã†ã‚„ã‚Šæ–¹ã«ã—ã¾ã—ãŸã€‚
ãƒ‘ãƒƒã¨è¦‹ã®ã‚ã‹ã‚Šã‚„ã™ã•ã®è¦³ç‚¹ã§ã¯å¤§å·®ãªã„ã¨åˆ¤æ–­ã—ãŸã®ã§ã€é–‹ç™ºä½“é¨“ã®è‰¯ã•ã‚’å„ªå…ˆã—ã¾ã—ãŸã€‚

# ãŠã¾ã‘

`/workspace/main.go`, `/workspace/go.mod` ã®ä¸­èº«ãŒæ°—ã«ãªã£ãŸã®ã§è¦—ã„ã¦ã¿ã¾ã—ãŸã€‚

```sh
â”œâ”€â”€ workspace
â”‚   â”œâ”€â”€ .googlebuild
â”‚   â”‚   â””â”€â”€ source-code.tar.gz
â”‚   â”œâ”€â”€ go.mod  # â† ã“ã‚Œ
â”‚   â”œâ”€â”€ go.sum
â”‚   â”œâ”€â”€ main.go # â† ã“ã‚Œ
â”‚   â””â”€â”€ serverless_function_source_code
â”‚       â”œâ”€â”€ cmd
â”‚       â”‚   â””â”€â”€ main.go
â”‚       â”œâ”€â”€ function.go
â”‚       â”œâ”€â”€ go.mod
â”‚       â”œâ”€â”€ go.sum
â”‚       â””â”€â”€ static
â”‚           â””â”€â”€ hoge.json
```

`function.go` ã«ä¸‹è¨˜ã®ã‚ˆã†ãªå‡¦ç†ã‚’æ›¸ãã€ã“ã‚Œã‚’ Cloud Functions ä¸Šã§å®Ÿè¡Œã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’å‡ºåŠ›ã—ã¦ã¿ã¾ã—ãŸã€‚

```go:function.go
func ReadFile(w http.ResponseWriter, r *http.Request) {
  b, err = os.ReadFile("/workspace/go.mod")
  if err != nil {
    panic(err)
  }
  log.Println(string(b))

  b, err := os.ReadFile("/workspace/main.go")
  if err != nil {
    panic(err)
  }
  log.Println(string(b))
}
```

`go.mod` ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã—ãŸã€‚

```text:go.mod
module functions.local/app

go 1.16

require (
  github.com/GoogleCloudPlatform/functions-framework-go v1.5.3
  github.com/kmtym1998/gcf-playground v0.0.0
)

replace github.com/kmtym1998/gcf-playground v0.0.0 => /workspace/serverless_function_source_code
```

`replace` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸé–¢æ•°ã® module ã‚’å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã­ã€‚ä½•ã‹ã—ã‚‰ã®ç†ç”±ãŒã‚ã£ã¦ãƒ¦ãƒ¼ã‚¶ãŒä½œæˆã—ãŸ module ã¨ã€ãã®å‡¦ç†ã‚’å‘¼ã³å‡ºã™ module ã‚’åˆ†ã‘ãŸã„æ„å›³ãŒã‚ã£ãŸã®ã‹ãªï¼Ÿã¨ã„ã†ã®ãŒæ¨æ¸¬ã§ãã¾ã™ã€‚åˆ¥ module ã§ä½œã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ‡ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ `serverless_function_source_code` ã®ã‚ˆã†ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œã‚‰ã‚Œã¦ã„ã‚‹ã®ã‚‚ç´å¾—ã§ãã‚‹æ°—ãŒã—ã¾ã™ã€‚

åŒéšå±¤ã® `main.go` ã®ä¸­èº«ã‚‚è¦‹ã¦ã¿ã¾ã—ãŸã€‚

```go:main.go
// Binary main file implements an HTTP server that loads and runs user's code
// on incoming HTTP requests.
// As this file must compile statically alongside the user code, this file
// will be copied into the function image and the 'FUNCTION_TARGET' and
// 'FUNCTION_PACKAGE' strings will be replaced by the relevant function and
// package names. That edited file will then be compiled as with the user's
// function code to produce an executable app binary that launches the HTTP
// server.
package main

import (
	"context"
	"fmt"
	"log"
	"net/http"
	"os"

	userfunction "github.com/kmtym1998/gcf-playground"

	"github.com/GoogleCloudPlatform/functions-framework-go/funcframework"
	cloudevents "github.com/cloudevents/sdk-go/v2"
)

func register(fn interface{}) error {
	ctx := context.Background()
	if fnHTTP, ok := fn.(func(http.ResponseWriter, *http.Request)); ok {
		if err := funcframework.RegisterHTTPFunctionContext(ctx, "/", fnHTTP); err != nil {
			return fmt.Errorf("Function failed to register: %v\n", err)
		}
	} else if fnCloudEvent, ok := fn.(func(context.Context, cloudevents.Event) error); ok {
		if err := funcframework.RegisterCloudEventFunctionContext(ctx, "/", fnCloudEvent); err != nil {
			return fmt.Errorf("Function failed to register: %v\n", err)
		}
	} else {
		if err := funcframework.RegisterEventFunctionContext(ctx, "/", fn); err != nil {
			return fmt.Errorf("Function failed to register: %v\n", err)
		}
	}
	return nil
}

func main() {
	if err := register(userfunction.ListFiles); err != nil {
		log.Fatalf("Function failed to register: %v\n", err)
	}

	// Don't invoke the function for reserved URLs.
	http.HandleFunc("/robots.txt", http.NotFound)
	http.HandleFunc("/favicon.ico", http.NotFound)

	port := os.Getenv("PORT")
	if port == "" {
		port = "8080"
	}
	if err := funcframework.Start(port); err != nil {
		log.Fatalf("Function failed to start: %v\n", err)
	}
}
```

Cloud Function ã®å®Ÿè¡Œç’°å¢ƒã§ã‚‚ Function Frameworks ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã® `main()` é–¢æ•°ãŒæœ€åˆã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§é–‹ç™ºã™ã‚‹ç‚ºã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ `cmd/main.go` ã¯ Cloud Functions ç’°å¢ƒã ã¨ä¸è¦ãªã®ã§ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡ã«ã—ãªãã¦è‰¯ã„ã®ã§ã™ã­ã€‚

---

Lambda ãªã©ã€ä»–ã® FaaS ã§ã¯ã©ã‚“ãªä»•æ§˜ã«ãªã£ã¦ã„ã‚‹ã®ã‹æ°—ã«ãªã‚Šã¾ã—ãŸã€‚æ°—ãŒå‘ã„ãŸã‚‰èª¿æŸ»ã—ã¦ã¿ã¾ã™ã€‚
