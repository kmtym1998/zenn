---
title: '複数の Hasura CLI のバージョンを切り替えられるツールを作りました'
emoji: '🕺'
type: 'tech' # tech: 技術記事 / idea: アイデア
topics: ['Hasura', 'Go', 'CLI']
published: false
---

# 開発物と開発経緯

いろいろな言語のバージョン管理ツールとして頻繁に使われる「〜env」的なものの Hasura CLI バージョンを作りました。

https://github.com/kmtym1998/hasuraenv

私の所属する会社で開発するプロダクトでは Hasura を全面的に採用し、Hasura を使ったプロダクトがいくつか存在します。それぞれのプロダクトごとに Hasura のバージョンが違うため、開発対象のプロダクトが変わるごとに `hasura update-cli` で CLI をインストールし直す必要がありました。その作業が毎度面倒なので [nodebrew](https://github.com/hokaccha/nodebrew) や [rbenv](https://github.com/rbenv/rbenv) のような簡単にバージョンを切り替えられるツールを作ることにしました。

# 使い方・機能

[README](https://github.com/kmtym1998/hasuraenv/blob/main/README.md) に書いたことを噛み砕いて書いただけなので、README を読めばいいやという方は読み飛ばしていただいて構いません。

## インストール

`go install` でバイナリをインストールします。

```sh
$ go install github.com/kmtym1998/hasuraenv/cmd/hasuraenv@latest
```

`hasuraenv init` での初期化処理と hasuraenv でインストールした Hasura CLI への PATH を通します。
`init` を実行すると自動的に最新の Hasura CLI をインストールし、そのバージョンの Hasura CLI が使われるようになります。

```sh
$ hasuraenv init

$ export PATH=$HOME/.hasuraenv/current:$PATH;
```

`hasura` コマンドの向き先が hasuraenv でインストールした Hasura CLI のものになっていることを確認します。

```sh
$ which hasura
[ホームディレクトリまでのパス]/.hasuraenv/current/hasura
```

## 使い方

```sh
$ hasuraenv --help
Manage multiple hasura-cli versions. Run 'hasuraenv --help' for usage

Usage:
  hasuraenv [flags]
  hasuraenv [command]

Available Commands:
  completion  Generate the autocompletion script for the specified shell
  help        Help about any command
  init        initialize hasuraenv
  install     Download and install <version>
  list        List installed versions
  ls-remote   List remote versions
  use         Use <version>
  version     Print the CLI version

Flags:
  -h, --help   help for hasuraenv

Use "hasuraenv [command] --help" for more information about a command.
```

コマンドのインターフェースは [nodebrew](https://github.com/hokaccha/nodebrew) を大いに参考にさせていただきました。
Hasura CLI のバージョンを新たにインストール ~ 切替の例を示します。

```sh
# 元の Hasura CLI のバージョンを確認
$ hasura version
INFO hasura cli                                    version=v2.1.0

# リリース済みの Hasura CLI のバージョンの最新 10 件を確認
$ hasuraenv ls-remote --limit 10
INFO Latest 10 releases
     v2.13.0-beta.1
     v2.12.0
     ...

# v2.13.0-beta.1 をインストール
$ hasuraenv install v2.13.0-beta.1

# インストール済みの Hasura CLI のバージョン一覧を確認
$ hasuraenv ls
INFO Installed hasura cli
     v2.1.0
     v2.9.0
     v2.9.0-beta.3
     v2.13.0-beta.1

# v2.13.0-beta.1 を使うように
$ hasuraenv use v2.13.0-beta.1

# バージョンが切り替わったことを確認
$ hasura version
INFO hasura cli                                    version=v2.13.0-beta.1
```

# 軽く実装の紹介

- Go (Cobra)
- シンボリックリンクに PATH 通している
- `~/.hasuraenv/versions` 配下に各バージョンの CLI を入れてる
- `use` でシンボリックリンクの向き先を変えてる

# おわりに

- PR や issue 大歓迎
- 使ってね

# 参考にしたページ
