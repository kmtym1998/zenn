---
title: 'interface / union ã‚’ gqlgen ã§å®Ÿè£…ã—ã¦ã¿ã‚‹'
emoji: 'ğŸš¥'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['Go', 'GraphQL', 'gqlgen']
published_at: 2023-03-20 08:00
published: true
---

## ã¯ã˜ã‚ã«

gqlgen ã‚’ä½¿ã£ã¦ union ã‚„ interface ã‚’å®Ÿè£…ã—ãŸäº‹ä¾‹ã«é–¢ã™ã‚‹æƒ…å ±ãŒã‚ã¾ã‚Šãªã‹ã£ãŸã®ã§ç´¹ä»‹ã—ã¾ã™ã€‚

union / interface ã¯ GraphQL ã«ãŠã‘ã‚‹å‹ã®ä¸€ç¨®ã§ã™ã€‚

https://graphql.org/learn/schema/#interfaces

https://www.apollographql.com/docs/apollo-server/schema/unions-interfaces/

## gqlgen ã«ã‚ˆã£ã¦ ç”Ÿæˆã•ã‚Œã‚‹å‹

GraphQL ã‚¹ã‚­ãƒ¼ãƒä¸Šã§ union ã‚„ interface ã‚’ä½¿ã£ãŸå®šç¾©ã‚’ã—ãŸã¨ãã«ã©ã†ã„ã£ãŸå‹ãŒç”Ÿæˆã•ã‚Œã‚‹ã‹ç´¹ä»‹ã—ã¾ã™ã€‚

ä¸‹è¨˜ã®ã‚ˆã†ãªã€id ã§å•†å“ (product) ã‚’å–å¾—ã™ã‚‹ Query ã‚’å®šç¾©ã—ãŸå ´åˆã‚’ä¾‹ã«æŒ™ã’ã¾ã™ã€‚

```graphql
extend type Query {
  product(id: ID!): Result!
}

union Result = Product | ErrorNotUnauthorized | ErrorUnauthenticated

interface Node {
  id: ID!
}

"æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹"
type Product implements Node {
  id: ID!
  name: String!
  price: Int!
}

interface Error {
  code: String!
  message: String!
}

"ç•°å¸¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹ - èªè¨¼ã‚¨ãƒ©ãƒ¼"
type ErrorNotUnauthorized implements Error {
  code: String!
  message: String!
}

"ç•°å¸¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹ - èªå¯ã‚¨ãƒ©ãƒ¼"
type ErrorUnauthenticated implements Error {
  code: String!
  message: String!
}
```

`products` ã®è¿”ã‚Šå€¤ `Result` ã¯ `Node` `ErrorNotUnauthorized` `ErrorUnauthenticated` ã® union ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®å‹ã¯ã™ã¹ã¦ interface ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆã¯ `Node` interface ã‚’ã€ç•°å¸¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆã¯ `Error` interface ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### union

ä¸Šè¨˜ã®ä¾‹ã§ã¯ `Result` å‹ãŒ union ã§å®šç¾©ã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ã“ã‚Œã‚’ gqlgen ã§ Go ã®å‹ã¨ã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ãª interface ã¨ã—ã¦å®šç¾©ã•ã‚Œã¾ã™ã€‚

```go
type Result interface {
	IsResult()
}

type Product struct {
	ID    string `json:"id"`
	Name  string `json:"name"`
	Price int    `json:"price"`
}

func (Product) IsResult() {}

type ErrorNotUnauthorized struct {
	Code    string `json:"code"`
	Message string `json:"message"`
}

func (ErrorNotUnauthorized) IsResult() {}

type ErrorUnauthenticated struct {
	Code    string `json:"code"`
	Message string `json:"message"`
}

func (ErrorUnauthenticated) IsResult() {}
```

Result å‹è‡ªä½“ã¯ `IsResult()` ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ interface ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚union ã«å«ã¾ã‚Œã‚‹ `Product` `ErrorNotUnauthorized` `ErrorUnauthenticated` ã® 3 ã¤ã®å‹ã¯ä½•ã‚‚å‡¦ç†ãŒãªã„ `IsResult()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒç”Ÿãˆã¦ã„ã‚‹ã®ã§ã€ã™ã¹ã¦ `Result` interface ã‚’æº€ãŸã—ã¦ã„ã¾ã™ã€‚

Go ã§ã“ã®ã‚ˆã†ãª union ã®è¡¨ç¾æ–¹æ³•ã¯ã‚ã¾ã‚Šè¦‹ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸãŒã€å€‹äººçš„ã«ã¯å‰²ã¨ã‚·ãƒ³ãƒ—ãƒ«ã§ã‚ã‹ã‚Šã‚„ã™ã„ã¨æ„Ÿã˜ã¾ã—ãŸã€‚

### interface

ç¶šã„ã¦ interface ã§ã™ã€‚

ã“ã“ã§ã¯ `Error` interface ã¨ãã‚Œã‚’å®Ÿè£…ã™ã‚‹å‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

```go
type Error interface {
	IsError()
	GetCode() string
	GetMessage() string
}

type ErrorNotUnauthorized struct {
	Code    string `json:"code"`
	Message string `json:"message"`
}

func (ErrorNotUnauthorized) IsError()                {}
func (this ErrorNotUnauthorized) GetCode() string    { return this.Code }
func (this ErrorNotUnauthorized) GetMessage() string { return this.Message }

type ErrorUnauthenticated struct {
	Code    string `json:"code"`
	Message string `json:"message"`
}

func (ErrorUnauthenticated) IsError()                {}
func (this ErrorUnauthenticated) GetCode() string    { return this.Code }
func (this ErrorUnauthenticated) GetMessage() string { return this.Message }
```

union ã¨åŒã˜ã‚ˆã†ã«ã€interface ã‚’æº€ãŸã™ã‹åˆ¤åˆ¥ã™ã‚‹ãŸã‚ã® `IsError()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒ `ErrorUnauthenticated`ãƒ»`ErrorNotUnauthorized` å‹ãã‚Œãã‚Œã«å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€`Error` interface ã‚’æº€ãŸã™å‹ãŒå¿…ãšæŒã¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚ã‚‹ `code` ã¨ `message` ã‚’å–å¾—ã™ã‚‹ `GetCode()` `GetMessage()` ã‚‚å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å±¤ãªã©ã§ã€ç‰¹å®šã® interface ã«å¯¾ã—ã¦ resolver ã‚’ã¾ãŸã„ã§å…±é€šã§å‡¦ç†ã‚’æŒŸã¿ãŸã„å ´åˆãªã©ã«ä½•ã‹ä½¿ãˆãã†ãªäºˆæ„ŸãŒã—ã¾ã™ã€‚

###### fyi.

gqlgen ãŒç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«ã¤ã„ã¦ã¯ä¸‹è¨˜ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ã§è»½ãè§¦ã£ã¦ã¿ã¦ã„ã¾ã™ã€‚

https://zenn.dev/kmtym1998/scraps/d2827a40e89744#comment-27e79a3929134f

## ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

å®Ÿå‹™ã§ã¯ Query / Mutation ã®è¿”ã‚Šå€¤ã¯å…±é€šã® interface ã‚’å®Ÿè£…ã—ãŸ type ã® union ã§å®šç¾©ã™ã‚‹ã‚„ã‚Šæ–¹ã‚’ã¨ã£ã¦ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªæ–¹æ³•ã‚’æ¡ç”¨ã—ãŸèƒŒæ™¯ã¨ã—ã¦ã¯ã€ã‚¨ãƒ©ãƒ¼ã®å‹ã‚’ GraphQL ã‚¹ã‚­ãƒ¼ãƒã¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æä¾›ã—ãŸã‹ã£ãŸã¨ã„ã†èƒŒæ™¯ãŒã‚ã‚Šã¾ã™ã€‚

çµŒç·¯ã‚„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç­‰ã®è©³ç´°ã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚ã‚ˆã‚ã—ã‘ã‚Œã°ã”å‚ç…§ãã ã•ã„ã€‚

https://tech.buysell-technologies.com/entry/2023/02/21/000000
